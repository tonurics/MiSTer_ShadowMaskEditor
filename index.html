<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>MiSTer - Shadow Mask Editor</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<style type="text/css">
		html,body{
			background-color:#454545;
			color:#eee;
			font-family:sans-serif;
			font-size:100%;
			height:100%;
			margin:0px;
			padding:0px;
		}
		body>h1,body>h2{
			margin:0px;
			padding:0.25em;
		}
		body>h1{
			background-color:#303030;
			font-size:120%;
		}
		body h2{
			font-size:110%;
			margin:0.25em;
		}
		body>div{
			border-bottom:1px solid rgba(0,0,0,0.25);
			padding:0px 0.5em 0.5em 0.5em;
		}
		label{
			display:inline-block;
			padding-right:0.25em;
			text-align:right;
			width:50px;
		}
		button{
			border:0px solid #000;
			cursor:pointer;
			text-align:center;
		}
		button:disabled{
			cursor:auto;
			opacity:0.5;
		}
		button:disabled svg{opacity:0.5;}
		button svg{margin:auto;}
		input[type=number]{width:75px;}
		textarea{
			background-color:#303030;
			border:1px solid #000;
			color:#fff;
			height:350px;
			margin:auto;
			width:550px;
		}
		kbd{
			background-color:#eee;
			border-radius:3px;
			border:1px solid #b4b4b4;
			box-shadow:0 1px 1px rgba(0, 0, 0, .2), 0 2px 0 0 rgba(255, 255, 255, .7) inset;
			color:#333;
			display:inline-block;
			font-size:.85em;
			font-weight:700;
			line-height:1;
			padding:2px 4px;
			white-space:nowrap;
		}
		.tools button,.intensityTools button,.toolsMask button{
			background-color:hsl(0,0%,65%);
			border-radius:3px;
			height:32px;
			padding:4px;
			width:32px;
		}
		.tools button.active,.toolsMask button.active{background-color:hsl(0,0%,90%);}
		.palette td{
			border:1px solid transparent;
			padding:0px;
		}
		.palette td.active{border:1px solid #fff;}
		.palette button{
			height:32px;
			width:32px;
		}
		.palette button div{
			display:inline-block;
			height:16px;
			width:16px;
		}
		.previewType label,.backgroundType label{width:auto;}
		.intensity{display:inline-block;}
		.intensity div{
			font-size:75%;
			text-align:right;
			color:#000;
		}
		.intensityTools{display:inline-block;}
		.preview canvas{
			border:1px solid #000;
			height:300px;
			width:300px;
		}
		.help table{border-collapse:collapse;}
		.help table th,.help table td{
			border:1px solid #000;
			padding:0.25em;
		}
		.help table caption{font-weight:bold;}
		.help table td:nth-last-child(-n+2){
			text-align:center;
		}
		#mask>div{
			box-sizing:border-box;
			display:block;
			line-height:0px;
			margin:0px;
			padding:0px;
			position:relative;
		}
		#mask>div>div{
			border:1px solid #000;
			cursor:pointer;
			display:inline-block;
			height:32px;
			width:32px;
		}
		#mask>div>div>div{
			height:16px;
			width:16px;
			margin:8px 8px;
		}
		#mask span{
			color:rgba(0,0,0,0.75);
			font-size:80%;
			user-select:none;
			user-drag:none;
			-webkit-user-drag:none;
		}
		#mask>div>span{
			top:18px;
			padding-left:4px;
			position:absolute;
			z-index:0;
		}
		#mask>span{
			border:1px solid rgba(0,0,0,0);
			display:inline-block;
			text-align:center;
			height:32px;
			width:32px;
		}
		#activeColor{
			border:1px solid #000;
			display:inline-block;
			height:64px;
			width:64px;
		}
		#activeEncode{
			color:#000;
			float:left;
			margin:32px 4px 0px 0px;
		}
		#activeColor div{
			height:32px;
			width:32px;
			margin:16px 16px;
		}
		#backgroundRainbowColors{width:40px;}
		#backgroundScale{width:30px;}
	</style>
	<script type="text/javascript">
		var mask_editor={
			toolActive:'pencil',
			toolPrevious:'pencil',
			mouseActive:false,
			renderWaiting:false,
			resolution:{
				0:'',
			},
			history:[
				[],
				[],
			],
			init:function(){
				document.body.addEventListener('mousedown',mask_editor.mouseDown);
				document.body.addEventListener('mouseup',mask_editor.mouseUp);
				document.body.addEventListener('keydown',mask_editor.keyDown);
				mask_editor.canvas={
					_:document.getElementById('previewCanvas').getContext('2d',{alpha:false}),
				};
				mask_editor.backgroundReset();
				document.getElementsByName('maskFile')[0].addEventListener('change',mask_editor.maskLoad);
				Array.prototype.map.call(document.querySelectorAll('.properties input'),function(e){
					e.addEventListener('change',mask_editor.maskResize);
				});
				Array.prototype.map.call(document.querySelectorAll('.previewType input'),function(e){
					e.addEventListener('change',mask_editor.previewRender);
				});
				Array.prototype.map.call(document.querySelectorAll('.backgroundType input'),function(e){
					e.addEventListener('change',mask_editor.backgroundChange);
				});
				document.getElementById('backgroundRainbowColors').addEventListener('change',mask_editor.backgroundChange);
				document.getElementById('backgroundScale').addEventListener('change',mask_editor.backgroundScaleChange);
				document.getElementsByName('backgroundFile')[0].addEventListener('change',mask_editor.backgroundLoad);
				Array.prototype.map.call(document.querySelectorAll('.tools button'),function(e){
					e.addEventListener('click',mask_editor.toolClick);
				});
				Array.prototype.map.call(document.querySelectorAll('.palette button'),function(e){
					e.addEventListener('click',mask_editor.paletteClick);
				});
				Array.prototype.map.call(document.querySelectorAll('.intensity input'),function(e){
					e.addEventListener('change',mask_editor.intensityChange);
					e.addEventListener('input',mask_editor.intensityInput);
				});
				Array.prototype.map.call(document.querySelectorAll('.intensityTools button'),function(e){
					e.addEventListener('click',mask_editor.intensityToolClick);
				});
				Array.prototype.map.call(document.querySelectorAll('.toolsMask button'),function(e){
					e.addEventListener('click',mask_editor.toolsToogle);
				});
				Array.prototype.map.call(document.querySelectorAll('.toolsMask select'),function(e){
					e.addEventListener('change',mask_editor.toolsTransform);
				});
				Array.prototype.map.call(document.querySelectorAll('.preview input'),function(e){
					e.addEventListener('change',mask_editor.previewResize);
				});
				Array.prototype.map.call(document.querySelectorAll('.maskDetails input,.maskDetails select'),function(e){
					e.addEventListener('change',mask_editor.maskDetailsChange);
				});
				document.getElementById('maskResolution').addEventListener('change',mask_editor.maskResolutionChange);
				document.getElementById('maskResolution').addEventListener('keydown',mask_editor.maskResolutionKeyDown);
				document.getElementById('maskResolution').nextElementSibling.nextElementSibling.nextElementSibling.addEventListener('click',mask_editor.maskResolutionAdd);
				document.getElementById('output').nextElementSibling.nextElementSibling.addEventListener('click',mask_editor.maskDownload);
				mask_editor.maskResize();
			},
			activeEncodeDisplay:function(){
				document.getElementById('activeEncode').innerHTML=[
					document.getElementById('activeColor').dataset.code,
					((document.getElementById('intensityOn').value-100)/6.25).toString(16),
					(document.getElementById('intensityOff').value/6.25).toString(16),
				].join('');
			},
			backgroundChange:function(){
				mask_editor.backgroundReset();
				mask_editor.previewRender();
			},
			backgroundReset:function(){
				mask_editor.canvas['bg']=document.createElement('canvas');
				mask_editor.canvas['bg'].width=document.getElementById('previewCanvas').width;
				mask_editor.canvas['bg'].height=document.getElementById('previewCanvas').height;
				mask_editor.canvas['bg'].style.width=document.getElementById('previewCanvas').style.width;
				mask_editor.canvas['bg'].style.height=document.getElementById('previewCanvas').style.height;
				mask_editor.canvas['bg']=mask_editor.canvas['bg'].getContext('2d',{alpha:false});
				mask_editor.canvas['bg'].imageSmoothingEnabled=false;
				switch(document.querySelector('input[name="background"]:checked').value){
					case 'none':
						mask_editor.canvas['bg'].fillStyle='hsl(0,0%,50%)';
						mask_editor.canvas['bg'].fillRect(0,0,document.getElementById('previewCanvas').width,document.getElementById('previewCanvas').height);
					break;
					case 'rainbow':
						var pattern=document.createElement('canvas');
						pattern.width=document.getElementById('previewCanvas').width;
						pattern.height=document.getElementById('previewCanvas').width;
						var ctx=pattern.getContext('2d',{alpha:false});
						ctx.createImageData(pattern.height,pattern.width);
						document.getElementById('backgroundRainbowColors').value=Math.max(1,Math.min(128,document.getElementById('backgroundRainbowColors').value));
						var size=(document.getElementById('previewCanvas').width/document.getElementById('backgroundRainbowColors').value);
						for(i=0;i<document.getElementById('backgroundRainbowColors').value;++i){
							switch(i%3){
								case 0:
									ctx.fillStyle='hsl('+(i*size)+',100%,47.5%)';
								break;
								case 1:
									ctx.fillStyle='hsl('+((i-1)*size)+',100%,65%)';
								break;
								default:
									ctx.fillStyle='hsl('+((i-2)*size)+',100%,30%)';
								break;
							}
							for(a=0;a<document.getElementById('backgroundRainbowColors').value;++a){
								ctx.fillRect(Math.ceil(((i*size)+(a*size)))%document.getElementById('previewCanvas').width,Math.ceil(a*size),Math.ceil(size),Math.ceil(size));
							}
						}
						mask_editor.canvas['bg'].rect(0,0,document.getElementById('previewCanvas').width,document.getElementById('previewCanvas').height);
						mask_editor.canvas['bg'].fillStyle=mask_editor.canvas['bg'].createPattern(pattern,'repeat');
						mask_editor.canvas['bg'].fill();
					break;
					case 'image':
						mask_editor.canvas['bg'].drawImage(mask_editor.backgroundImage,0,0,mask_editor.backgroundImage.width,mask_editor.backgroundImage.height);
					break;
				}
			},
			backgroundLoad:function(e){
				const reader=new FileReader();
				document.getElementById('backgroundFile').disabled=false;
				document.getElementById('backgroundFile').checked=true;
				reader.addEventListener('load',function(){
					mask_editor.backgroundImage=new Image;
					mask_editor.backgroundImage.src=reader.result;
					mask_editor.backgroundImage.onload=function(){
						this.originalWidth=this.width;
						this.originalHeight=this.height;
						mask_editor.backgroundScale();
						if(document.getElementById('backgroundResizePreview').checked){
							document.getElementById('previewWidth').value=this.width;
							document.getElementById('previewHeight').value=this.height;
							mask_editor.previewResize();
						}
						if(document.querySelector('input[name="background"]:checked').value=='image'){
							mask_editor.canvas['bg'].drawImage(this,0,0,this.width,this.height);
							mask_editor.previewRender();
						}
					};
				},false);
				if(e.target.files[0]){
					reader.readAsDataURL(e.target.files[0]);
				}
			},
			backgroundScale:function(){
				if(mask_editor.backgroundImage){
					mask_editor.backgroundImage.width=mask_editor.backgroundImage.originalWidth*Math.max(1,document.getElementById('backgroundScale').value);
					mask_editor.backgroundImage.height=mask_editor.backgroundImage.originalHeight*Math.max(1,document.getElementById('backgroundScale').value);
					if(document.getElementById('backgroundResizePreview').checked){
						document.getElementById('previewWidth').value=mask_editor.backgroundImage.width;
						document.getElementById('previewHeight').value=mask_editor.backgroundImage.height;
						mask_editor.previewResize();
					}
				}
			},
			backgroundScaleChange:function(){
				mask_editor.backgroundScale();
				mask_editor.backgroundChange();
			},
			colorHSL:function(e){
				var intensity=e.dataset.intensity.split(',').map(function(e){return parseFloat(e);});
				var on=((((intensity[1]-100)/100)*50)+50),off=((intensity[0]/100)*50);
				switch(e.dataset.bits){
					case '000':
						e.style.backgroundColor='hsl(0,0%,'+off+'%)';
						e.childNodes[0].style.backgroundColor='hsl(0,0%,46.875%)';
					break;
					case '111':
						e.style.backgroundColor='hsl(0,0%,'+on+'%)';
						e.childNodes[0].style.backgroundColor='hsl(0,0%,46.875%)';
					break;
					default:
						var hues={'000':0,'001':240,'010':120,'011':180,'100':0,'101':300,'110':60,'111':0,};
						e.style.backgroundColor='hsl('+hues[e.dataset.bits]+',100%,'+on+'%)';
						e.childNodes[0].style.backgroundColor='hsl('+hues[String(e.dataset.bits^111).padStart(3,'0')]+',100%,'+off+'%)';
					break;
				}
			},
			paletteClick:function(e){
				var n=e.target;
				while(n.tagName.toLowerCase()!='button'){
					n=n.parentNode;
				}
				if(
					mask_editor.toolActive=='dropper'||
					mask_editor.toolActive=='eraser'
				){
					if([
						'dropper',
						'eraser',
					].includes(mask_editor.toolPrevious)){
						document.querySelector('.tools button[name="pencil"]').dispatchEvent(new Event('click'));
					}else{
						document.querySelector('.tools button[name="'+mask_editor.toolPrevious+'"]').dispatchEvent(new Event('click'));
					}
				}
				mask_editor.maskSet(n,document.getElementById('activeColor'));
				mask_editor.activeEncodeDisplay();
			},
			intensityChange:function(){
				Array.prototype.map.call(document.querySelectorAll('.palette button,#activeColor'),function(e){
					e.dataset.intensity=[document.getElementById('intensityOff').value,document.getElementById('intensityOn').value];
					mask_editor.colorHSL(e);
				});
				mask_editor.activeEncodeDisplay();
			},
			intensityInput:function(e){
				e.target.nextElementSibling.innerHTML=e.target.value;
				mask_editor.activeEncodeDisplay();
			},
			intensityToolClick:function(e){
				var n=e.target;
				while(n.tagName.toLowerCase()!='button'){
					n=n.parentNode;
				}
				switch(n.name){
					case 'half':
						document.getElementById('intensityOn').value=((parseFloat(document.getElementById('intensityOn').value)-100)*0.5)+100;
						document.getElementById('intensityOff').value=((93.75-parseFloat(document.getElementById('intensityOff').value))*0.5)+parseFloat(document.getElementById('intensityOff').value);
					break;
					case 'plus':
						document.getElementById('intensityOn').value=parseFloat(document.getElementById('intensityOn').value)+6.25;
						document.getElementById('intensityOff').value=parseFloat(document.getElementById('intensityOff').value)-6.25;
					break;
					case 'minus':
						document.getElementById('intensityOn').value=parseFloat(document.getElementById('intensityOn').value)-6.25;
						document.getElementById('intensityOff').value=parseFloat(document.getElementById('intensityOff').value)+6.25;
					break;
					case 'reset':
						document.getElementById('intensityOn').value=112.5;
						document.getElementById('intensityOff').value=62.5;
					break;
					case 'invert':
						var off=(parseFloat(document.getElementById('intensityOn').value)-100),on=(parseFloat(document.getElementById('intensityOff').value)+100);
						document.getElementById('intensityOn').value=on;
						document.getElementById('intensityOff').value=off;
					break;
				}
				document.getElementById('intensityOn').dispatchEvent(new Event('input'));
				document.getElementById('intensityOff').dispatchEvent(new Event('input'));
				mask_editor.intensityChange();
			},
			keyDown:function(e){
				if(
					e.target.tagName.toLowerCase()!='input'&&
					e.target.tagName.toLowerCase()!='select'&&
					e.target.tagName.toLowerCase()!='textarea'
				){
					switch(e.key){
						case '`':
							if(document.querySelector('input[name="preview"]:checked').value!='simple'){
								document.getElementById('previewSimple').checked=true;
							}else{
								document.getElementById('previewAccurate').checked=true;
							}
							mask_editor.previewRender()
						break;
						case '0':
						case '1':
						case '2':
						case '3':
						case '4':
						case '5':
						case '6':
						case '7':
						case 'b':
						case 'c':
						case 'g':
						case 'k':
						case 'm':
						case 'r':
						case 'w':
						case 'y':
							document.querySelectorAll('.palette button')[{
								'0':4,'1':3,'2':2,'3':7,'4':1,'5':5,'6':6,'7':0,
								'b':3,'c':7,'g':2,'k':4,'m':5,'r':1,'w':0,'y':6,
							}[e.key]].dispatchEvent(new Event('click'));
						break;
						case '+':
						case '-':
						case '/':
						case 'Escape':
						case 'i':
							document.querySelector('.intensityTools button[name="'+{
								'+':'plus',
								'-':'minus',
								'/':'half',
								'Escape':'reset',
								'i':'invert',
							}[e.key]+'"]').dispatchEvent(new Event('click'));
						break;
						case 'd':
						case 'e':
						case 'f':
						case 'p':
							document.querySelector('.tools button[name="'+{
								'd':'dropper',
								'e':'eraser',
								'f':'fill',
								'p':'pencil',
							}[e.key]+'"]').dispatchEvent(new Event('click'));
						break;
						case 'S':
						case 's':
							if(
								e.ctrlKey&&
								e.shiftKey
							){
								mask_editor.maskDownload();
							}
						break;
						case 'Z':
						case 'z':
							if(e.ctrlKey){
								if(e.shiftKey){
									document.querySelector('.tools button[name="redo"]').dispatchEvent(new Event('click'));
								}else{
									document.querySelector('.tools button[name="undo"]').dispatchEvent(new Event('click'));
								}
							}
						break;
					}
				}
			},
			maskClick:function(e){
				n=e.target;
				if(!n.dataset.hasOwnProperty('bits')){
					n=n.parentNode;
				}
				var tool=mask_editor.toolActive;
				if(e.shiftKey){
					mask_editor.toolActive='fill';
				}
				if(e.ctrlKey){
					mask_editor.toolActive='dropper';
				}
				if([
						'pencil',
						'eraser',
						'fill',
					].includes(mask_editor.toolActive)&&
					(
						mask_editor.history[0].length==0||
						(
							mask_editor.history[0][mask_editor.history[0].length-1]!=mask_editor.resolution[document.getElementById('maskResolution').value]
						)
					)
				){
					mask_editor.history[0].push(mask_editor.resolution[document.getElementById('maskResolution').value]);
					mask_editor.history[0]=mask_editor.history[0].slice(-16);
					mask_editor.history[1]=[];
					document.querySelector('.tools button[name="undo"]').disabled=false;
					document.querySelector('.tools button[name="redo"]').disabled=true;
				}
				switch(mask_editor.toolActive){
					case 'pencil':
						mask_editor.maskSet(document.getElementById('activeColor'),n);
						mask_editor.maskExport();
					break;
					case 'eraser':
						n.dataset.bits='111';
						n.dataset.code=7;
						n.dataset.intensity=[62.5,112.5];
						n.style.backgroundColor='hsl(0,0%,56.25%)';
						n.childNodes[0].style.backgroundColor='hsl(0,0%,46.875%)';
						mask_editor.maskExport();
					break;
					case 'fill':
						var code=n.dataset.code,intensity=n.dataset.intensity;
						Array.prototype.map.call(document.querySelectorAll('#mask>div>div'),function(e){
							if(
								e.dataset.code==code&&
								e.dataset.intensity==intensity
							){
								mask_editor.maskSet(document.getElementById('activeColor'),e);
							}
						});
						mask_editor.maskExport();
					break;
					case 'dropper':
						mask_editor.maskSet(n,document.getElementById('activeColor'));
						var intensity=n.dataset.intensity.split(',');
 						document.getElementById('intensityOn').value=parseFloat(intensity[1]);
 						document.getElementById('intensityOff').value=parseFloat(intensity[0]);
 						document.getElementById('intensityOn').dispatchEvent(new Event('input'));
						document.getElementById('intensityOff').dispatchEvent(new Event('input'));
 						mask_editor.intensityChange();
					break;
				}
				if(
					(
						mask_editor.toolActive=='pencil'||
						mask_editor.toolActive=='eraser'
					)&&
					(
						document.getElementById('mirrorV').classList.contains('active')||
						document.getElementById('mirrorH').classList.contains('active')
					)
				){
					var w=n.dataset.w,h=n.dataset.h;
					if(document.getElementById('mirrorV').classList.contains('active')){
						h=Math.round((1-((parseInt(n.dataset.h)+1)/parseInt(document.getElementById('maskHeight').value)))*parseInt(document.getElementById('maskHeight').value));
					}
					if(document.getElementById('mirrorH').classList.contains('active')){
						w=Math.round((1-((parseInt(n.dataset.w)+1)/parseInt(document.getElementById('maskWidth').value)))*parseInt(document.getElementById('maskWidth').value));
					}
					mask_editor.maskSet(n,mask_editor.mask[h][w]);
					mask_editor.maskExport();
				}
				mask_editor.toolActive=tool;
			},
			maskDetailsChange:function(){
				mask_editor.maskExport();
			},
			maskDownload:function(){
				var e=document.createElement('a');
				e.setAttribute('href','data:text/plain;charset=utf-8,'+encodeURIComponent(document.getElementById('output').value));
				if(document.getElementById('maskName').value){
					e.setAttribute('download',document.getElementById('maskName').value+'.txt');
					if(document.getElementById('maskSubPixelLayout').value){
						e.setAttribute('download',document.getElementById('maskName').value+' ['+document.getElementById('maskSubPixelLayout').value+']'+'.txt');
					}
				}else{
					e.setAttribute('download','ShadowMask.txt');
				}
				e.style.display='none';
				document.body.appendChild(e);
				e.click();
				document.body.removeChild(e);
				document.getElementById('maskName').value='';
			},
			maskExport:function(){
				var output=[
					'v2',
					[
						document.getElementById('maskWidth').value,
						document.getElementById('maskHeight').value,
					].join(','),
				];
				for(const [y,row] of Object.entries(mask_editor.mask)){
					var line=[];
					for(const [x,pixel] of Object.entries(row)){
						var intensity=pixel.dataset.intensity.split(',').map(function(e){return parseFloat(e);});
						line.push(pixel.dataset.code+((intensity[1]-100)/6.25).toString(16)+(intensity[0]/6.25).toString(16));
					}
					output.push(line.join(','));
				}
				mask_editor.resolution[document.getElementById('maskResolution').value]=output.join("\n");
				var comment=[];
				output=[];
				for(var [k,v] of Object.entries({
					'Name':'maskName',
					'Author':'maskAuthor',
					'Type':'maskType',
					'Genre':'maskGenre',
					'Sub-Pixel Layout':'maskSubPixelLayout',
				})){
					if(document.getElementById(v).value){
						comment.push([
							'# '+k+': '+document.getElementById(v).value,
						]);
					}
				}
				if(document.getElementById('maskInformation').value){
					comment=comment.concat([
						'#',
						'# Information:',
						'# '+document.getElementById('maskInformation').value,
					]);
				}
				if(comment.length){
					output=[
						'####',
						comment.join("\n"),
						'####',
						'',
					];
				}
				for(var [res,mask] of Object.entries(mask_editor.resolution)){
					output.push('Resolution='+res);
					output.push(mask+"\n");
				}
				document.getElementById('output').value=output.join("\n").trim();
				mask_editor.previewRender();
			},
			maskLoad:function(e){
				const reader=new FileReader();
				reader.addEventListener('load',reader.addEventListener('load',function(){
					if(!document.getElementById('maskFileUseResolution').checked){
						while(document.getElementById('maskResolution').options.length>1){
							document.getElementById('maskResolution').selectedIndex=1;
							mask_editor.maskResolutionRemove();
						}
					}
					mask_editor.maskParse(reader.result);
					if(document.getElementById('maskResolution').options.length>1){
						for(var i=0;i<document.getElementById('maskResolution').options.length;++i){
							if(parseInt(document.getElementById('maskResolution').options[i].value)<=parseInt(document.getElementById('previewHeight').value)){
								document.getElementById('maskResolution').selectedIndex=i;
							}
						}
						mask_editor.maskResolutionChange();
					}
				}));
				if(e.target.files[0]){
					if(document.getElementById('maskName').value==''){
						document.getElementById('maskName').value=e.target.files[0].name.replace(/( \[([RGB]{3}|Monochrome)\])?\.txt$/g,'');
					}
					reader.readAsText(e.target.files[0]);
				}
			},
			maskMouseOver:function(e){
				if(!mask_editor.mouseActive){
					return;
				}
				n=e.target;
				if(!n.dataset.hasOwnProperty('bits')){
					n=n.parentNode;
				}
				n.dispatchEvent(new Event('click'));
			},
			maskParse:function(text){
				var row=0,height=false,intensity=[
					[62.5,112.5],
					[62.5,112.5],
				],previewType=document.querySelector('input[name="preview"]:checked').value,version='1.0';
				if(document.querySelector('input[name="preview"]:checked').value!='simple'){
					document.getElementById('previewSimple').checked=true;
				}
				text.split('\n').forEach(function(line){
					line=line.trim();
					if(line==''){
						return;
					}
					if(line.charAt(0)=='#'){
						if(match=line.match(/^# (?<Field>Name|Author|Type|Genre|Sub-Pixel Layout): (?<Value>.*)$/)){
							document.getElementById({
								'Name':'maskName',
								'Author':'maskAuthor',
								'Type':'maskType',
								'Genre':'maskGenre',
								'Sub-Pixel Layout':'maskSubPixelLayout',
							}[match.groups['Field']]).value=match.groups['Value'].trim();
						}
						return;
					}
					if(line.charAt(0)=='R'){
						if(match=line.match(/^Resolution=(?<MinHeight>\d*)$/)){
							mask_editor.maskExport();
							row=0,height=false,intensity=[
								[62.5,112.5],
								[62.5,112.5],
							],version='1.0';
							if(!document.getElementById('maskFileUseResolution').checked){
								document.getElementById('maskResolution').nextElementSibling.nextElementSibling.value=match.groups['MinHeight'];
								mask_editor.maskResolutionAdd();
							}
						}
						return;
					}
					if(line=='v2'){
						version='2.0';
						return;
					}
					if(
						!height&&
						(match=line.match(/^(?<Width>\d{1,2}),(?<Height>\d{1,2})(,(?<IntensityA1>[0-9\.]+),(?<IntensityA2>[0-9\.]+))?(,(?<IntensityB1>[0-9\.]+),(?<IntensityB2>[0-9\.]+))?$/))
					){
						height=true;
						match.groups['Width']=Math.min(16,Math.max(1,parseInt(match.groups['Width'])));
						match.groups['Height']=Math.min(16,Math.max(1,parseInt(match.groups['Height'])));
						if(
							document.getElementById('maskWidth').value!=match.groups['Width']||
							document.getElementById('maskHeight').value!=match.groups['Height']
						){
							document.getElementById('maskWidth').value=match.groups['Width'];
							document.getElementById('maskHeight').value=match.groups['Height'];
							mask_editor.maskResize();
						}
						if(match.groups['IntensityA1']){
							version='1.3';
							match.groups['IntensityA1']=parseFloat(match.groups['IntensityA1']);
							match.groups['IntensityA2']=parseFloat(match.groups['IntensityA2']);
							if(match.groups['IntensityA1']<100){
								version='1.1';
								match.groups['IntensityA1']+=100;
							}
							intensity[0][1]=match.groups['IntensityA1'];
							intensity[0][0]=match.groups['IntensityA2'];
						}
						if(match.groups['IntensityB1']){
							match.groups['IntensityB1']=parseFloat(match.groups['IntensityB1']);
							match.groups['IntensityB2']=parseFloat(match.groups['IntensityB2']);
							if(match.groups['IntensityB1']<100){
								match.groups['IntensityB1']+=100;
							}
							intensity[1][1]=intensity[0][1];
							intensity[1][0]=intensity[0][0];
							intensity[0][1]=match.groups['IntensityB1'];
							intensity[0][0]=match.groups['IntensityB2'];
						}else{
							intensity[1][1]=match.groups['IntensityA1'];
							intensity[1][0]=match.groups['IntensityA2'];
						}
						return;
					}
					if(line.match(/^[0-9A-Fa-f,rgbcmykwRGBCMYKW]*$/)){
						line=line.split(',');
						var bits={
							0:'000',1:'001',2:'010',3:'011',4:'100',5:'101',6:'110',7:'111',
						},column=0;
						line.forEach(function(location){
							switch(version){
								case '1.0':
								case '1.1':
								case '1.3':
									var set=0;
									location={
										'0':0,'1':1,'2':2,'3':3,'4':4,'5':5,'6':6,'7':7,'8':8,
										'9':9,'10':10,'11':11,'12':12,'13':13,'14':14,'15':15,
										'K':0,'B':1,'G':2,'C':3,'R':4,'M':5,'Y':6,'W':7,'k':8,
										'b':9,'g':10,'c':11,'r':12,'m':13,'y':14,'w':15,
									}[location];
									if(location>8){
										location-=8;
										set=1;
									}
									mask_editor.mask[row][column].dataset.code=location;
									mask_editor.mask[row][column].dataset.bits=bits[location];
									mask_editor.mask[row][column].dataset.intensity=intensity[set];
									mask_editor.colorHSL(mask_editor.mask[row][column]);
								break;
								case '2.0':
									location=location.split('');
									location[0]=parseInt(location[0]);
									location[1]=parseInt(location[1],16);
									location[2]=parseInt(location[2],16);
									mask_editor.mask[row][column].dataset.code=location[0];
									mask_editor.mask[row][column].dataset.bits=bits[location[0]];
									mask_editor.mask[row][column].dataset.intensity=[(location[2]*6.25),((location[1]*6.25)+100)];
									mask_editor.colorHSL(mask_editor.mask[row][column]);
								break;
							}
							++column;
						});
						++row;
					}
				});
				if(previewType=='accurate'){
					document.getElementById('previewAccurate').checked=true;
				}
				mask_editor.maskExport();
			},
			maskResize:function(e){
				var p=document.getElementById('mask');
				while(p.firstChild){
					p.removeChild(p.firstChild);
				}
				Array.prototype.map.call(document.querySelectorAll('.properties input'),function(e){
					e.value=Math.min(16,e.value);
				});
				if(
					mask_editor.resolution[document.getElementById('maskResolution').value]&&
					e
				){
					mask_editor.history[0].push(mask_editor.resolution[document.getElementById('maskResolution').value]);
					mask_editor.history[0]=mask_editor.history[0].slice(-16);
					mask_editor.history[1]=[];
					document.querySelector('.tools button[name="undo"]').disabled=false;
					document.querySelector('.tools button[name="redo"]').disabled=true;
				}
				var row={};
				mask_editor.mask={};
				for(let h=0;h<document.getElementById('maskHeight').value;++h){
					row[h]=document.createElement('div');
					if(!mask_editor.mask.hasOwnProperty(h)){
						mask_editor.mask[h]={};
					}
					for(let w=0;w<document.getElementById('maskWidth').value;++w){
						mask_editor.mask[h][w]=document.createElement('div');
						mask_editor.mask[h][w].dataset.h=h;
						mask_editor.mask[h][w].dataset.w=w;
						mask_editor.mask[h][w].addEventListener('click',mask_editor.maskClick);
						mask_editor.mask[h][w].addEventListener('mouseover',mask_editor.maskMouseOver);
						mask_editor.mask[h][w].appendChild(document.createElement('div'));
						mask_editor.maskSet(document.getElementById('activeColor'),mask_editor.mask[h][w]);
						row[h].appendChild(mask_editor.mask[h][w]);
					}
					var s=document.createElement('span');
					s.innerHTML=h+1;
					row[h].appendChild(s);
					p.appendChild(row[h]);
				}
				for(let w=0;w<document.getElementById('maskWidth').value;++w){
					var s=document.createElement('span');
					s.innerHTML=w+1;
					p.appendChild(s);
				}
				mask_editor.maskExport();
			},
			maskResolutionAdd:function(e){
				var options=Array.apply(null,document.getElementById('maskResolution').options).map(function(e){return parseInt(e.value);}),userInput=false,v=Math.max(0,Math.min(2160,document.getElementById('maskResolution').nextElementSibling.nextElementSibling.value));
				if(e){
					userInput=true;
				}
				if(!options.includes(v)){
					var e=document.createElement('option');
					e.text=v;
					e.name=v;
					e.value=v;
					for(var i=0;i<options.length;++i){
						if(
							(
								options[i+1]&&
								options[i+1]>v
							)||!options[i+1]
						){
							document.getElementById('maskResolution').add(e,i+1);
							document.getElementById('maskResolution').selectedIndex=i+1;
							break;
						}
					}
					mask_editor.resolution[v]='';
					mask_editor.maskExport();
					if(userInput){
						document.getElementById('maskFile').value=null;
					}
				}
			},
			maskResolutionChange:function(userInput=false){
				mask_editor.maskParse(mask_editor.resolution[document.getElementById('maskResolution').value]);
				mask_editor.history[0]=[];
				mask_editor.history[1]=[];
				document.querySelector('.tools button[name="undo"]').disabled=true;
				document.querySelector('.tools button[name="redo"]').disabled=true;
				if(userInput){
					document.getElementById('maskFile').value=null;
				}
			},
			maskResolutionKeyDown:function(e){
				if(!document.getElementById('maskResolution').options[document.getElementById('maskResolution').selectedIndex]){
					return;
				}
				if(
					e.key=='-'||
					e.key=='Delete'||
					e.key=='Backspace'
				){
					mask_editor.maskResolutionRemove(true);
				}else if(e.key=='+'){
					document.getElementById('maskResolution').nextElementSibling.nextElementSibling.nextElementSibling.dispatchEvent(new Event('click'));
				}
			},
			maskResolutionRemove:function(userInput=false){
				var v=document.getElementById('maskResolution').options[document.getElementById('maskResolution').selectedIndex].value;
				if(
					document.getElementById('maskResolution').options.length>1&&
					v!=0
				){
					if(userInput){
						if(!confirm('Are you sure you want to remove the '+v+' resolution?')){
							return;
						}
					}
					document.getElementById('maskResolution').remove(document.getElementById('maskResolution').selectedIndex);
					delete mask_editor.resolution[v];
					document.getElementById('maskResolution').selectedIndex=0;
					mask_editor.maskResolutionChange(userInput);
				}
			},
			maskSet:function(src,dst){
				dst.dataset.bits=src.dataset.bits;
				dst.dataset.code=src.dataset.code;
				dst.dataset.intensity=src.dataset.intensity;
				dst.style.backgroundColor=src.style.backgroundColor;
				dst.childNodes[0].style.backgroundColor=src.childNodes[0].style.backgroundColor;
			},
			mouseDown:function(){
				mask_editor.mouseActive=true;
			},
			mouseUp:function(){
				mask_editor.mouseActive=false;
				if(mask_editor.renderWaiting){
					mask_editor.renderWaiting=false;
					if(window.getSelection){
						window.getSelection().removeAllRanges();
					}
					mask_editor.previewRender();
				}
			},
			previewRender:function(){
				if(mask_editor.mouseActive){
					mask_editor.renderWaiting=true;
					return;
				}
				switch(document.querySelector('input[name="preview"]:checked').value){
					case 'simple':
						var mask=document.createElement('canvas');
						mask.height=document.getElementById('maskHeight').value;
						mask.width=document.getElementById('maskWidth').value;
						if(document.getElementById('previewRotate').checked){
							mask.height=document.getElementById('maskWidth').value;
							mask.width=document.getElementById('maskHeight').value;
						}
						if(document.getElementById('previewDouble').checked){
							mask.height*=2;
							mask.width*=2;
						}
						var ctx=mask.getContext('2d',{alpha:false});
						ctx.createImageData(mask.height,mask.width);
						if(document.getElementById('previewDouble').checked){
							ctx.imageSmoothingEnabled=false;
							ctx.transform(2,0,0,2,0,0);
						}
						for(const [y,row] of Object.entries(mask_editor.mask)){
							for(const [x,pixel] of Object.entries(row)){
								ctx.fillStyle=pixel.style.backgroundColor;
								if(document.getElementById('previewRotate').checked){
									ctx.fillRect(y,x,1,1);
								}else{
									ctx.fillRect(x,y,1,1);
								}
							}
						}
						mask_editor.canvas['_'].rect(0,0,document.getElementById('previewCanvas').width,document.getElementById('previewCanvas').height);
						mask_editor.canvas['_'].fillStyle=mask_editor.canvas['_'].createPattern(mask,'repeat');
						mask_editor.canvas['_'].fill();
					break;
					case 'accurate':
						var debounce;
						clearTimeout(debounce);
						debounce=setTimeout(function(){
							if(document.querySelector('input[name="preview"]:checked').value!='accurate'){
								return;
							}
							var imageData=mask_editor.canvas['bg'].getImageData(0,0,document.getElementById('previewCanvas').width,document.getElementById('previewCanvas').height);
							const data=imageData.data;
							var count=0;
							for(var i=0;i<data.length;i+=4){
								var pos=[
									Math.floor(count/document.getElementById('previewCanvas').width),
									(count%document.getElementById('previewCanvas').width),
								];
								if(document.getElementById('previewDouble').checked){
									pos=pos.map(function(e){return Math.floor(e*0.5);});
								}
								if(document.getElementById('previewRotate').checked){
									var pixel=mask_editor.mask[pos[1]%document.getElementById('maskHeight').value][pos[0]%document.getElementById('maskWidth').value];
								}else{
									var pixel=mask_editor.mask[pos[0]%document.getElementById('maskHeight').value][pos[1]%document.getElementById('maskWidth').value];
								}
								var bits=pixel.dataset.bits.split('').map(function(e){return parseInt(e);}),intensity=pixel.dataset.intensity.split(',').map(function(e){return parseFloat(e)/100;});
								data[i]=Math.min(255,Math.round(data[i]*intensity[bits[0]]));
								data[i+1]=Math.min(255,Math.round(data[i+1]*intensity[bits[1]]));
								data[i+2]=Math.min(255,Math.round(data[i+2]*intensity[bits[2]]));
								++count;
							}
							mask_editor.canvas['_'].putImageData(imageData,0,0);
						},300);
					break;
				}
			},
			previewResize:function(e){
				document.getElementById('previewCanvas').width=document.getElementById('previewWidth').value;
				document.getElementById('previewCanvas').height=document.getElementById('previewHeight').value;
				document.getElementById('previewCanvas').style.width=document.getElementById('previewWidth').value+'px';
				document.getElementById('previewCanvas').style.height=document.getElementById('previewHeight').value+'px';
				mask_editor.backgroundReset();
				mask_editor.previewRender();
			},
			toolClick:function(e){
				var n=e.target;
				while(n.tagName.toLowerCase()!='button'){
					n=n.parentNode;
				}
				switch(n.name){
					case 'redo':
						if(mask_editor.history[1].length){
							mask_editor.history[0].push(mask_editor.resolution[document.getElementById('maskResolution').value]);
							document.querySelector('.tools button[name="undo"]').disabled=false;
							mask_editor.maskParse(mask_editor.history[1].pop());
						}
						if(!mask_editor.history[1].length){
							document.querySelector('.tools button[name="redo"]').disabled=true;
						}
						return;
					break;
					case 'undo':
						if(mask_editor.history[0].length){
							mask_editor.history[1].push(mask_editor.resolution[document.getElementById('maskResolution').value]);
							document.querySelector('.tools button[name="redo"]').disabled=false;
							var mask=mask_editor.history[0].pop();
							while(mask==mask_editor.resolution[document.getElementById('maskResolution').value]){
								mask=mask_editor.history[0].pop();
							}
							if(mask){
								mask_editor.maskParse(mask);
							}
						}
						if(!mask_editor.history[0].length){
							document.querySelector('.tools button[name="undo"]').disabled=true;
						}
						return;
					break;
				}
				Array.prototype.map.call(document.querySelectorAll('.tools button'),function(e){
					e.classList.remove('active');
				});
				n.classList.add('active');
				mask_editor.toolPrevious=mask_editor.toolActive;
				mask_editor.toolActive=n.name;
			},
			toolsToogle:function(e){
				var n=e.target;
				while(n.tagName.toLowerCase()!='button'){
					n=n.parentNode;
				}
				n.classList.toggle('active');
			},
			toolsTransform:function(e,action=null){
				if(!action){
					action=document.getElementById('transform').value;
				}
				document.getElementById('transform').value='';
				if(
					mask_editor.history[0].length==0||
					(
						mask_editor.history[0][mask_editor.history[0].length-1]!=mask_editor.resolution[document.getElementById('maskResolution').value]
					)
				){
					mask_editor.history[0].push(mask_editor.resolution[document.getElementById('maskResolution').value]);
					mask_editor.history[0]=mask_editor.history[0].slice(-16);
					mask_editor.history[1]=[];
					document.querySelector('.tools button[name="undo"]').disabled=false;
					document.querySelector('.tools button[name="redo"]').disabled=true;
				}
				var mask=mask_editor.resolution[document.getElementById('maskResolution').value].split("\n"),tmp=[];
				tmp.push(mask.shift());
				tmp.push(mask.shift());
				switch(action){
					case 'RGB2BGR':
					case 'RGB2BRG':
					case 'RGB2GBR':
					case 'RGB2GRB':
					case 'RGB2RBG':
					case 'RGB2MYC':
					case 'W2K':
						var map={
							'':[0,1,2,3,4,5,6,7],
							'RGB2BGR':[0,4,2,5,1,3,6,7],
							'RGB2BRG':[0,2,4,6,1,3,5,7],
							'RGB2GBR':[0,4,1,5,2,6,3,7],
							'RGB2GRB':[0,1,4,3,2,6,5,7],
							'RGB2RBG':[0,2,1,6,4,5,3,7],
							'RGB2MYC':[0,3,6,1,5,4,2,7],
							'W2K':[7,1,2,3,4,5,6,0],
						}[action];
						for(var row of mask){
							row=row.split(',');
							row.forEach((v,k)=>{
								v=v.split('');
								v[0]=map[v[0]];
								row[k]=v.join('');
							});
							tmp.push(row.join(','));
						}
						mask_editor.maskParse(tmp.join("\n"));
					break;
					case 'doubleV':
						tmp[1]=tmp[1].split(',')
						tmp[1][1]*=2;
						if(tmp[1][1]>16){
							alert('Aborted: The new Mask would be too large.');
							return;
						}
						tmp[1]=tmp[1].join(',');
						for(var row of mask){
							tmp.push(row);
							tmp.push(row);
						}
						mask_editor.maskParse(tmp.join("\n"));
					break;
					case 'doubleH':
						mask_editor.toolsTransform(e,'rot90');
						mask_editor.toolsTransform(e,'doubleV');
						mask_editor.toolsTransform(e,'rot90');
					break;
					case 'doubleCols':
						mask_editor.toolsTransform(e,'rot90');
						mask_editor.toolsTransform(e,'doubleRows');
						mask_editor.toolsTransform(e,'rot90');
					break;
					case 'doubleRows':
						var count=0,prev='';
						for(var row of mask){
							++count;
							tmp.push(row);
							if(prev!=row){
								++count;
								tmp.push(row);
								prev=row;
							}
						}
						if(count>16){
							alert('Aborted. The new Mask would be too large.');
							return;
						}
						tmp[1]=tmp[1].split(',')
						tmp[1][1]=count;
						mask_editor.maskParse(tmp.join("\n"));
					break;
					case 'flipH':
							for(var row of mask){
								tmp.push(row.split(',').reverse().join(','));
							}
							mask_editor.maskParse(tmp.join("\n"));
					break;
					case 'flipV':
							mask_editor.maskParse(tmp.concat(mask.reverse()).join("\n"));
					break;
					case 'rot90':
						tmp[1]=tmp[1].split(',').reverse().join(',');
						mask.forEach((v,k)=>{
							mask[k]=v.split(',');
						});
						mask=Object.keys(mask[0]).map(function(c) {
							return mask.map(function(r) { return r[c]; });
						});
						mask.forEach((v,k)=>{
							mask[k]=v.join(',');
						});
						mask_editor.maskParse(tmp.concat(mask).join("\n"));
					break;
				}
			},
		};
		window.addEventListener('load',function(){
			mask_editor.init();
		},false);
	</script>
</head>
<body>
	<h1>MiSTer - Shadow Mask Editor</h1>
	<div style="display:grid;grid-template-columns:auto auto auto auto;">
		<div>
			<h2>Load Mask</h2>
			<div><input type="file" id="maskFile" name="maskFile" accept="text/plain"></div>
			<div><input id="maskFileUseResolution" type="checkbox"><label for="maskFileUseResolution" style="width:auto;">Use selected resolution.</label></div>
		</div>
		<div class="properties">
			<h2>Properties</h2>
			<div>
				<div>
					<label for="maskWidth">Width</label><input type="number" min="1" max="16" value="1" step="1" id="maskWidth">
				</div>
				<div>
					<label for="maskHeight">Height</label><input type="number" min="1" max="16" value="1" step="1" id="maskHeight">
				</div>
			</div>
		</div>
		<div class="previewType">
			<h2>Preview Type</h2>
			<div>
				<div>
					<input type="radio" name="preview" id="previewSimple" value="simple" checked="checked"><label for="previewSimple">Simple</label>
				<div>
				</div>
					<input type="radio" name="preview" id="previewAccurate" value="accurate"><label for="previewAccurate">Accurate</label>
				</div>
				<div>
					<input id="previewRotate" type="checkbox"><label for="previewRotate">Rotate</label>
					<input id="previewDouble" type="checkbox"><label for="previewDouble">2x</label>
				</div>
			</div>
		</div>
		<div class="backgroundType">
			<h2>Background Type</h2>
			<div>
				<input type="radio" name="background" id="backgroundNone" value="none" checked="checked"><label for="backgroundNone">None</label>
			</div>
			<div>
				<input type="radio" name="background" id="backgroundRainbow" value="rainbow"><label for="backgroundRainbow">Rainbow</label><input id="backgroundRainbowColors" type="number" min="1" max="128" value="24">
			</div>
			<div>
				<div style="display:inline-block;">
					<input disabled="disabled" type="radio" name="background" id="backgroundFile" value="image"><label for="backgroundFile">Image</label><br>&nbsp;
				</div>
				<div style="display:inline-block;">
					<input type="file" name="backgroundFile" accept="image/*">
					<div>
						<label for="backgroundScale">ScaleX</label>
						<input id="backgroundScale" type="number" min="1" max="64" value="1">
						<input id="backgroundResizePreview" type="checkbox"><label style="width:auto;" for="backgroundResizePreview">Resize Preview</label>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div style="display:grid;grid-template-columns:auto auto auto auto;">
		<div>
			<table class="tools">
				<tr>
					<td><button name="pencil" title="Mark Locations" class="active"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(44.112 -256.04)"><g transform="translate(-125.11 79.043)"><path transform="translate(241 217)" d="m-146.84-39-1.875 2c1.3287 0.02586 2.6651 1.2116 2.7188 2.4375l2-2c-0.0554-1.2653-1.4744-2.4884-2.8438-2.4375z" style="fill-rule:evenodd"/><path d="m83.631 189.04 7.5202-8.0345c1.3694-0.0509 2.7941 1.1634 2.8494 2.4288l-7.49 7.794-4.51 1.7757z" style="fill-rule:evenodd"/></g></g></svg></button></td>
					<td><button name="eraser" title="Erase"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="matrix(1.2513 0 0 1.2513 107.78 -433.99)"><g transform="translate(-149.73 129.23)"><path d="m72.156 218c-0.07885 0.0161-0.1595 0.0696-0.21875 0.125l-4.2812 4 4.0312 4.3438 4.1562-3.875c0.23699-0.22144 0.17839-0.68283-0.125-1.0312l-2.7812-3.2188c-0.22754-0.26132-0.54469-0.39209-0.78125-0.34375z"/><path d="m66.5 223.22-2.3438 2.1875c-0.23699 0.22144-0.20964 0.68283 0.09375 1.0312l2.8125 3.2188c0.30339 0.34842 0.73176 0.44019 0.96875 0.21875l2.4688-2.3125z" style="fill:#241f31;opacity:.5"/></g></g></svg></button></td>
					<td><button disabled="disabled" name="redo" title="Redo"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -1036.4)"><g transform="matrix(-1,0,0,1,16,0)"><g transform="translate(-285 -71)"><path d="m286 1113.4 4 4v-8z" style="color:#000000"/><path d="m290 1112.4v2h5.5c0.8403 0 1.5 0.66 1.5 1.5v1c0 0.841-0.6597 1.5-1.5 1.5h-0.5v2h0.5c1.9212 0 3.5-1.579 3.5-3.5v-1c0-1.921-1.5788-3.5-3.5-3.5z" style="color:#000000;stroke-width:2"/></g></g></g></svg></button></td>
				</tr>
				<tr>
					<td><button name="fill" title="Replace Matching Colour"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(-32.101 -315.77)"><g transform="translate(32.101 -720.6)"><g transform="translate(-141 859.36)"><path transform="translate(241 217)" d="m-92-36.844-2.4688 1.8125-2.5312 1.8438 1.2812 1.875 1.0625 1.5625 2.7812 4.1562c0.38364 0.5682 1.0736 0.76981 1.5312 0.4375l4.9688-3.5938c0.45762-0.33233 0.50866-1.0568 0.125-1.625l-2.75-4.0625v1.4375c0 1.1046-0.89543 2-2 2s-2-0.89543-2-2z"/><rect x="150" y="177" width="1.9975" height="8" rx="1" ry="1"/></g><path d="m1.4616 1043.2c0.53387-1.3767 6.5405-3.211 4.4098-1.7978l-2.6635 1.7665s-0.01341 3.9521 0.02626 6.084c0.01315 0.7068-0.3916 1.2125-0.92813 1.2288-0.56365 0.017-1.0115-0.3153-1.0631-1.2288-0.12032-2.1291-0.45614-4.3122 0.21875-6.0527z" style="fill:#241f31;opacity:.5"/></g></g></svg></button></td>
					<td><button name="dropper" title="Eye Dropper"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(-54.412 -315.77)"><g transform="matrix(1 0 0 .99725 -126.59 139.25)"><path d="m191.61 182.4-4.2202 5.6634-1.694 1.4926-0.69772-0.56071 0.99632-2.0533 4.2202-5.6634z" style="fill-rule:evenodd"/><path d="m185 189.57s-1.4772 0.66848-1.4654 2.0797c0.0147 1.758 2.6601 1.8434 2.7433 0.28446 0.0475-0.89097-1.2779-2.3642-1.2779-2.3642z" style="fill-rule:evenodd;fill:#241f31;opacity:.5"/><path d="m187.65 181.43 4.6492 3.5274 0.70445-0.92575-1.3947-1.0582c2.8037-0.79322 4.7199-4.1748 2.8603-5.5858-1.8597-1.4109-4.7057 1.2652-4.7199 4.1749l-1.3948-1.0582z" style="fill-rule:evenodd"/></g></g></svg></button></td>
					<td><button disabled="disabled" name="undo" title="Undo"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -1036.4)"><g><g transform="translate(-285 -71)"><path d="m286 1113.4 4 4v-8z" style="color:#000000"/><path d="m290 1112.4v2h5.5c0.8403 0 1.5 0.66 1.5 1.5v1c0 0.841-0.6597 1.5-1.5 1.5h-0.5v2h0.5c1.9212 0 3.5-1.579 3.5-3.5v-1c0-1.921-1.5788-3.5-3.5-3.5z" style="color:#000000;stroke-width:2"/></g></g></g></svg></button></td>
				</tr>
			</table>
		</div>
		<div>
			<table class="palette">
				<tr>
					<td><button data-bits='111' data-code="7" data-intensity="62.5,112.5" style="background-color:hsl(0,0%,56.25%);" title="White"><div style="background-color:hsl(0,0%,46.875%);"></div></button></td>
					<td><button data-bits='100' data-code="4" data-intensity="62.5,112.5" style="background-color:hsl(0,100%,56.25%);" title="Red"><div style="background-color:hsl(180,100%,31.25%);"></div></button></td>
					<td><button data-bits='010' data-code="2" data-intensity="62.5,112.5" style="background-color:hsl(120,100%,56.25%);" title="Green"><div style="background-color:hsl(300,100%,31.25%);"></div></button></td>
					<td><button data-bits='001' data-code="1" data-intensity="62.5,112.5" style="background-color:hsl(240,100%,56.25%);" title="Blue"><div style="background-color:hsl(60,100%,31.25%);"></div></button></td>
				</tr>
				<tr>
					<td><button data-bits='000' data-code="0" data-intensity="62.5,112.5" style="background-color:hsl(0,0%,31.25%);" title="Black"><div style="background-color:hsl(0,0%,46.875%);"></div></button></td>
					<td><button data-bits='101' data-code="5" data-intensity="62.5,112.5" style="background-color:hsl(300,100%,56.25%);" title="Magenta"><div style="background-color:hsl(120,100%,31.25%);"></div></button></td>
					<td><button data-bits='110' data-code="6" data-intensity="62.5,112.5" style="background-color:hsl(60,100%,56.25%);" title="Yellow"><div style="background-color:hsl(240,100%,31.25%);"></div></button></td>
					<td><button data-bits='011' data-code="3" data-intensity="62.5,112.5" style="background-color:hsl(180,100%,56.25%);" title="Cyan"><div style="background-color:hsl(0,100%,31.25%);"></div></button></td>
				</tr>
			</table>
		</div>
		<div>
			<span id="activeEncode">72a</span>
			<div id="activeColor" data-bits='111' data-code="7" data-intensity="62.5,112.5" style="background-color:hsl(0,0%,56.25%);" title="Active Colour"><div style="background-color:hsl(0,0%,46.875%);"></div></div>
			<div class="intensity">
				<input id="intensityOn" type="range" min="100" max="193.75" step="6.25" value="112.5" title="&quot;On&quot; Intensity"><div>112.5</div>
				<input id="intensityOff" type="range" min="0" max="93.75" step="6.25" value="62.5" title="&quot;Off&quot; Intensity"><div>62.5</div>
			</div>
			<table class="intensityTools">
				<tr>
					<td><button name="plus" title="Increase Intensity"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g transform="translate(.79319 -1033.6)"><g transform="translate(-.79319 -2.7952)"><rect y="1036.4" width="16" height="16" style="opacity:0;stroke-width:.21381"/><g transform="matrix(-.95044 .95568 -.95568 -.95044 951.75 2043.7)"><path d="m-34.832 1015.3a1.1115 1.1115 0 0 0-0.7793 1.9062l5.7324 5.7676a1.1115 1.1115 0 1 0 1.5762-1.5664l-5.7324-5.7676a1.1115 1.1115 0 0 0-0.79688-0.3398z" style="color-rendering:auto;color:#000000;dominant-baseline:auto;font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;image-rendering:auto;isolation:auto;mix-blend-mode:normal;shape-padding:0;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"/><path d="m-29.102 1015.3a1.0786 1.0786 0 0 0-0.74024 0.3301l-5.7656 5.83a1.0786 1.0786 0 1 0 1.5332 1.5157l5.7656-5.8301a1.0786 1.0786 0 0 0-0.79297-1.8457z" style="color-rendering:auto;color:#000000;dominant-baseline:auto;font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;image-rendering:auto;isolation:auto;mix-blend-mode:normal;shape-padding:0;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"/></g></g></g></svg></button></td>
					<td><button name="half" title="Reduce Intensity By Half"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(-11.895 -273.54)"><g transform="translate(-129.1 -3.4605)"><path d="m144 277 3 4 3-4z"/><path d="m144 293 3-4 3 4z"/><path d="m142 282v6h14v-6zm1 1h12v4h-12v-4z"/><rect x="147" y="283" width="3" height="4" style="opacity:.3"/><rect x="146" y="284" width="1" height="1" style="opacity:.3"/><rect x="146" y="286" width="1" height="1" style="opacity:.3"/><rect x="153" y="283" width="1.9999" height="4"/><rect x="152" y="285" width="1" height="1"/><rect x="152" y="283" width="1" height="1"/><rect x="145" y="285" width="1" height="1" style="opacity:.3"/><rect x="145" y="283" width="1" height="1" style="opacity:.3"/><rect transform="scale(1,-1)" x="151" y="-287" width="1" height="1"/><rect transform="scale(1,-1)" x="151" y="-285" width="1" height="1"/><rect transform="scale(1,-1)" x="150" y="-284" width="1" height="1"/><rect transform="scale(1,-1)" x="150" y="-286" width="1" height="1"/></g></g></svg></button></td>
					<td></td>
				</tr>
				<tr>
					<td><button name="minus" title="Deceases Intensity"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g transform="translate(7.7932 -1039.6)"><g transform="translate(-7.7932 3.2048)"><rect y="1036.4" width="16" height="16" style="opacity:0;stroke-width:.21381"/><g transform="matrix(-.95044 .95568 -.95568 -.95044 951.75 2043.7)"><path d="m-34.832 1015.3a1.1115 1.1115 0 0 0-0.7793 1.9062l5.7324 5.7676a1.1115 1.1115 0 1 0 1.5762-1.5664l-5.7324-5.7676a1.1115 1.1115 0 0 0-0.79688-0.3398z" style="color-rendering:auto;color:#000000;dominant-baseline:auto;font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;image-rendering:auto;isolation:auto;mix-blend-mode:normal;shape-padding:0;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"/></g></g></g></svg></button></td>
					<td><button name="invert" title="Swap Intensity Levels"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(-82.508 14.565)"><g transform="translate(-78.492 -513.57)"><path d="m161 499v16h16v-16zm1 1h14v14h-14z"/><path transform="translate(241 217)" d="m-79 283v14l3.4688-3.4688c-0.90482-0.90482-1.4688-2.1505-1.4688-3.5312 0-2.7614 2.2386-5 5-5 1.3807 0 2.6264 0.56393 3.5312 1.4688l3.4688-3.4688z"/><path d="m174 507c0 2.7614-2.2386 5-5 5-1.3807 0-2.6264-0.56393-3.5312-1.4688l7.0625-7.0625c0.90482 0.90482 1.4688 2.1505 1.4688 3.5312z"/></g></g></svg></button></td>
					<td><button name="reset" title="Reset To Defaults"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="matrix(1.0009 0 0 1.0002 0 -1036.6)"><rect y="1036.4" width="16" height="15.997" style="opacity:0;stroke-width:.99989"/><path d="m7 1049.9a2.5 2.4995 0 0 1-2.5 2.4995 2.5 2.4995 0 0 1-2.5-2.4995 2.5 2.4995 0 0 1 2.5-2.4995 2.5 2.4995 0 0 1 2.5 2.4995z"/><path d="m4 1046.4-4-3.9992h8z"/><path d="m8.7168 1050.9c2.5588 0.04 4.8717-1.5623 5.8555-3.9941 0.9838-2.4319 0.48634-5.2392-1.2852-7.1387-1.7715-1.8995-4.5089-2.4977-6.8672-1.4766-2.3583 1.0211-3.8672 3.4214-3.8672 6.0567h2c0-1.8726 1.0721-3.5323 2.6621-4.2207 1.59-0.6885 3.3861-0.3058 4.6094 1.0058 1.2232 1.3117 1.5876 3.3102 0.89453 5.0235-0.69311 1.7132-2.2629 2.7729-3.9707 2.746z" style="color-rendering:auto;color:#000000;dominant-baseline:auto;font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;image-rendering:auto;isolation:auto;mix-blend-mode:normal;shape-padding:0;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"/></g></svg></button></td>
				</tr>
			</table>
		</div>
		<div class="toolsMask">
			<div>
				<button id="mirrorV" name="mirrorV" title="Mirror Input Vertically"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g transform="translate(3.2712 -1037.1)"><g transform="matrix(0 -.99876 1 0 -1039.6 1053.1)"><g><g><path d="m7.043 1036.4v16h1.9141v-16z" style="color-rendering:auto;color:#000000;dominant-baseline:auto;fill-rule:evenodd;font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;image-rendering:auto;isolation:auto;mix-blend-mode:normal;shape-padding:0;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"/><path d="m0 1038.4c-0.044521 4.1443 0 6 0 6s0.020814 2.9749 0 6c-0.0069811 1.0146 1 1 1 1h4v-1h-4v-12h4v-1h-4s-0.98944 0.017-1 1z" style="color-rendering:auto;color:#000000;fill-rule:evenodd;image-rendering:auto;isolation:auto;mix-blend-mode:normal;paint-order:stroke fill markers;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-transform:none;white-space:normal"/><rect x="12.996" y="1050.4" width="1.0012" height="1"/><rect x="10.994" y="1050.4" width="1.0012" height="1"/><rect x="14.999" y="1048.4" width="1.0012" height="1"/><rect x="14.999" y="1039.4" width="1.0012" height="1"/><rect x="12.996" y="1037.4" width="1.0012" height="1"/><rect x="10.994" y="1037.4" width="1.0012" height="1"/></g><path d="m15 1050.4 0.01367 1h0.24805c0.40619-0.0072 0.73828-0.3437 0.73828-0.75v-0.25h-0.25z" style="color-rendering:auto;color:#000000;dominant-baseline:auto;font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;image-rendering:auto;isolation:auto;mix-blend-mode:normal;paint-order:stroke fill markers;shape-padding:0;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"/><path d="m15 1038.4 0.01367-1h0.24805c0.40619 0.01 0.73828 0.3419 0.73828 0.7481v0.248h-0.25z" style="color-rendering:auto;color:#000000;dominant-baseline:auto;font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;image-rendering:auto;isolation:auto;mix-blend-mode:normal;paint-order:stroke fill markers;shape-padding:0;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"/></g><path transform="matrix(.93275 .37141 -.42883 .80786 458.66 187.61)" d="m12.146 1058.7-6.7205-0.6089 1.9438-2.7579 1.9438-2.7578 1.4165 3.0623z"/></g></g></svg></button>
				<button id="mirrorH" name="mirrorH" title="Mirror Input Horizontally"><svg width="24" height="24" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g transform="translate(1.2382 -1037.7)"><g transform="matrix(.99876 0 0 1 -1.2185 1.3718)"><g><g><path d="m7.043 1036.4v16h1.9141v-16z" style="color-rendering:auto;color:#000000;dominant-baseline:auto;fill-rule:evenodd;font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;image-rendering:auto;isolation:auto;mix-blend-mode:normal;shape-padding:0;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"/><path d="m0 1038.4c-0.044521 4.1443 0 6 0 6s0.020814 2.9749 0 6c-0.0069811 1.0146 1 1 1 1h4v-1h-4v-12h4v-1h-4s-0.98944 0.017-1 1z" style="color-rendering:auto;color:#000000;fill-rule:evenodd;image-rendering:auto;isolation:auto;mix-blend-mode:normal;paint-order:stroke fill markers;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-transform:none;white-space:normal"/><rect x="12.996" y="1050.4" width="1.0012" height="1"/><rect x="10.994" y="1050.4" width="1.0012" height="1"/><rect x="14.999" y="1048.4" width="1.0012" height="1"/><rect x="14.999" y="1039.4" width="1.0012" height="1"/><rect x="12.996" y="1037.4" width="1.0012" height="1"/><rect x="10.994" y="1037.4" width="1.0012" height="1"/></g><path d="m15 1050.4 0.01367 1h0.24805c0.40619-0.0072 0.73828-0.3437 0.73828-0.75v-0.25h-0.25z" style="color-rendering:auto;color:#000000;dominant-baseline:auto;font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;image-rendering:auto;isolation:auto;mix-blend-mode:normal;paint-order:stroke fill markers;shape-padding:0;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"/><path d="m15 1038.4 0.01367-1h0.24805c0.40619 0.01 0.73828 0.3419 0.73828 0.7481v0.248h-0.25z" style="color-rendering:auto;color:#000000;dominant-baseline:auto;font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;image-rendering:auto;isolation:auto;mix-blend-mode:normal;paint-order:stroke fill markers;shape-padding:0;shape-rendering:auto;solid-color:#000000;text-decoration-color:#000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"/></g><path transform="matrix(.93275 .37141 -.42883 .80786 458.66 187.61)" d="m12.146 1058.7-6.7205-0.6089 1.9438-2.7579 1.9438-2.7578 1.4165 3.0623z"/></g></g></svg></button>
			</div>
			<div>
				<label for="transform">Transform</label><br>
				<select id="transform" style="width:75px;">
					<option value="">Select:</option>
					<optgroup label="Position">
						<option value="flipV">Flip Mask Vertically</option>
						<option value="flipH">Flip Mask Horizontally</option>
						<option value="rot90">Rotate Mask 90&deg;</option>
					</optgroup>
					<optgroup label="Size">
						<option value="doubleV">Scale 1x2</option>
						<option value="doubleH">Scale 2x1</option>
						<option value="doubleRows">Scale Unique 1x2</option>
						<option value="doubleCols">Scale Unique 2x1</option>
					</optgroup>
					<optgroup label="Sub-pixel Layouts">
						<option value="RGB2BGR">RGB &lt;-&gt; BGR</option>
						<option value="RGB2BRG">RGB &lt;-&gt; BRG</option>
						<option value="RGB2GBR">RGB &lt;-&gt; GBR</option>
						<option value="RGB2GRB">RGB &lt;-&gt; GRB</option>
						<option value="RGB2RBG">RGB &lt;-&gt; RBG</option>
					</optgroup>
					<optgroup label="Color">
						<option value="RGB2MYC">RGB &lt;-&gt; MYC</option>
						<option value="W2K">W &lt;-&gt; K</option>
					</optgroup>
				</select>
			</div>
		</div>
	</div>
	<div style="display:grid;grid-gap:0px 10px;grid-template-columns:auto auto;">
		<div style="grid-row:1;">
			<h2>Mask</h2>
		</div>
		<div style="grid-row:1;">
			<h2>Preview</h2>
		</div>
		<div style="grid-row:2/4;">
			<div id="mask"></div>
		</div>
		<div class="preview" style="grid-row:2;overflow-x:auto;">
			<canvas id="previewCanvas" width="300" height="300"></canvas>
		</div>
		<div class="preview" style="grid-row:3;">
			<input id="previewWidth" type="number" value="300">x<input id="previewHeight" type="number" value="300">
		</div>
	</div>
	<div style="display:grid;grid-gap:10px;grid-template-columns:49% auto%;">
		<div class="maskDetails" style="grid-row:1;">
			<h2>Details</h2>
			<div>
				<label for="maskName">Name</label><input type="text" id="maskName" name="maskName" placeholder="Lo-Tek PVM-1995">
			</div>
			<div>
				<label for="maskAuthor">Author</label><input type="text" id="maskAuthor" name="maskAuthor" placeholder="Johnny Mnemonic">
			</div>
			<div>
				<label for="maskType">Type</label><select id="maskType" name="maskType">
					<option value="">Select:</option>
					<option value="CRT">CRT</option>
					<option value="LCD">LCD</option>
					<option value="LED">LED</option>
					<option value="Other">Other</option>
				</select>
			</div>
			<div>
				<label for="maskGenre">Genre</label><input type="text" id="maskGenre" name="maskGenre" list="maskGenres" placeholder="Realistic">
				<datalist id="maskGenres">
					<option value="BVM">
					<option value="Bright">
					<option value="Dark">
					<option value="Fantasy">
					<option value="Generic">
					<option value="Geometric">
					<option value="Handheld">
					<option value="JVC">
					<option value="Mosaic">
					<option value="Neutral">
					<option value="PVM">
					<option value="Realistic">
					<option value="Slot Mask">
					<option value="Tinted">
					<option value="VGA">
				</datalist>
			</div>
			<div>
				<label for="maskSubPixelLayout">Layout</label><select id="maskSubPixelLayout" name="maskSubPixelLayout">
					<option value="">Select:</option>
					<option value="Monochrome">Monochrome</option>
					<option value="BGR">BGR</option>
					<option value="BRG">BRG</option>
					<option value="GBR">GBR</option>
					<option value="GRB">GRB</option>
					<option value="RBG">RBG</option>
					<option value="RGB">RGB</option>
				</select>
			</div>
			<div>
				<br><label for="maskInformation">Information</label><br><input type="text" id="maskInformation" name="maskInformation" placeholder="Replicates nerve attenuation syndrome.">
			</div>
		</div>
		<div class="maskResolutions" style="grid-row:2;">
			<h2>Resolutions</h2>
			<label for="maskResolution">Min Height</label>
			<div style="display:inline-block;">
				<select id="maskResolution" name="maskResolution" size="6" style="width:100%;">
					<option value="0" selected="selected">0</option>
				</select><br>
				<input type="number" min="0" max="2160" name="Height" value="1080"> <button>Add</button>
			</div>
		</div>
		<div class="maskDefinition" style="grid-row:1/3;">
			<h2>Definition</h2>
			<div>
				<textarea id="output" readonly="readonly" onclick="this.focus();this.select()"></textarea><br>
				<button>Download</button>
			</div>
			<h2>Instructions</h2>
			<ol>
				<li>Create a folder named <strong>Shadow_Masks</strong> in the root of your MiSTer MicroSD Card.</li>
				<li>Copy &amp; paste the above Mask Definition into a new text file (*.txt) inside of the Shadow_Masks folder.</li>
				<li>Select your Mask from the MiSTer GUI.</li>
			</ol>
		</div>
	</div>
	<div class="help">
		<h2>The Colour Palette</h2>
		<p>Each location in a Shadow Mask contains two sets of intensity information [shown as two squares in the editor]. The primary "on" set increases intensity of matching colour channels, causing them to appear brighter [the larger square]. The reverse "off" set deceases intensity of opposite colour channels, causing them to appear darker [the smaller square].</p>
	</div>
	<div class="help">
		<h2>Preview Types</h2>
		<p>There are two ways to view a Shadow Mask with the editor. The <strong>Simple</strong> mode is very fast and intended for quick reference and composition. And the more CPU intensive <strong>Accurate</strong> mode that recreates the way MiSTer will render the Shadow Mask. Keep in mind: the position of the Preview window of the editor and sub-pixel layouts of the screens used will greatly affect the appearance of your Shadow Mask. What looks good on one screen may not look as good on another; it all comes down to the sub-pixel layouts of the screens.</p>
		<table>
			<caption>Preview Type Feature Matrix</caption>
			<tr><th></th><th>Simple</th><th>Accurate</th></tr>
			<tr><td>Fast</td><td>&check;</td><td></td></tr>
			<tr><td>Matches MiSTer</td><td></td><td>&check;</td></tr>
			<tr><td>Color Intensity</td><td></td><td>&check;</td></tr>
			<tr><td>Rainbow Test Pattern</td><td></td><td>&check;</td></tr>
			<tr><td>Background Images</td><td></td><td>&check;</td></tr>
		</table>
	</div>
	<div class="help">
		<h2>Tools</h2>
		<dl>
			<dt>Pencil <kbd>P</kbd></dt>
			<dd>Will allow you to mark locations on the Shadow Mask with the current active colour.</dd>
			<dt>Eraser <kbd>E</kbd></dt>
			<dd>Will make the selected location on the Shadow Mask transparent, regardless of the current active colour.</dd>
			<dt>Flood Fill <kbd>F</kbd> <kbd>Shift+click</kbd></dt>
			<dd>Will replace all the locations in the Shadow Mask that match the selected location with the current active colour.</dd>
			<dt>Eye Dropper <kbd>D</kbd> <kbd>Ctrl+click</kbd></dt>
			<dd>Will replace the active colour with the selected location from the Shadow Mask.</dd>
			<dt>Undo <kbd>Ctrl+Z</kbd></dt>
			<dd>Undo the last operation</dd>
			<dt>Redo <kbd>Ctrl+Shift+Z</kbd></dt>
			<dd>Redo the last operation that was undone</dd>
		</dl>
		<h2>Palette Controls</h2>
		<dl>
			<dt>Add <kbd>+</kbd></dt>
			<dd>Increase intensities by one step.</dd>
			<dt>Minus <kbd>-</kbd></dt>
			<dd>Decease intensities by one step.</dd>
			<dt>Half <kbd>/</kbd></dt>
			<dd>Decease intensities by half.</dd>
			<dt>Invert <kbd>I</kbd></dt>
			<dd>Swap "on"/"off" intensities.</dd>
			<dt>Reset <kbd>Esc</kbd></dt>
			<dd>Revert changes to defaults.</dd>
		</dl>
		<h2>Resolution Controls</h2>
		<dl>
			<dt>Add <kbd>+</kbd></dt>
			<dd>Create entry for resolution.</dd>
			<dt>Minus <kbd>-</kbd> <kbd>Delete</kbd> <kbd>Backspace</kbd></dt>
			<dd>Remove selected resolution.</dd>
		</dl>
		<h2>Miscellaneous</h2>
		<dl>
			<dt>Toogle Preview Type <kbd>`</kbd></dt>
			<dt>Download Definition <kbd>Ctrl+Shift+S</kbd></dt>
		</dl>
	</div>
	<div class="help">
		<h2>Additional Information</h2>
		<p>Most items and tools on the editor interface have tooltips that appear when hovered over.</p>
		<p>Chrome is noticeably faster than Firefox, but may cause erroneous anti-aliasing to appear in the preview area.</p>
	</div>
</body>
</html>